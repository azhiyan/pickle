--
-- Sqlite based Schema
--

-- Presets
-- enable strict foreignkey maps
PRAGMA foreign_keys = ON;

-- Create USER table
CREATE TABLE user (
    user_idn INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
    first_name varchar(25) NOT NULL,
    last_name varchar(25),
    user_name varchar(25) NOT NULL,
    hash1 VARCHAR(64) NOT NULL,
    hash2 VARCHAR(64),
    phone_no1 number NOT NULL,
    phone_no2 number,
    email_id varchar(50),
    crt_dt DATETIME,
    upd_dt DATETIME,
    is_active number(1) DEFAULT 1
)

--Create Code Status
CREATE  TABLE  IF NOT EXISTS "main"."code_status" (
    "status_idn" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL , 
    "status" VARCHAR NOT NULL  UNIQUE , 
    "crt_dt" DATETIME NOT NULL  DEFAULT CURRENT_TIMESTAMP, 
    "upd_dt" DATETIME NOT NULL 
)

--Insert into code_status
INSERT INTO "main"."code_status" ("status","crt_dt","upd_dt") VALUES ('success',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP);
INSERT INTO "main"."code_status" ("status","crt_dt","upd_dt") VALUES ('failure',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP);
INSERT INTO "main"."code_status" ("status","crt_dt","upd_dt") VALUES ('error',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP);
INSERT INTO "main"."code_status" ("status","crt_dt","upd_dt") VALUES ('loggedin',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP);
INSERT INTO "main"."code_status" ("status","crt_dt","upd_dt") VALUES ('loggedout',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP);
INSERT INTO "main"."code_status" ("status","crt_dt","upd_dt") VALUES ('timedout',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP);


--Create User Session



CREATE  TABLE  IF NOT EXISTS "main"."user_session" (
    "user_session_idn" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL , 
    "user_idn" INTEGER NOT NULL , 
    "client_ip" VARCHAR NOT NULL , 
    "browser_name" VARCHAR, 
    "browser_version" VARCHAR, 
    "attempted_on" DATETIME NOT NULL  DEFAULT CURRENT_TIMESTAMP, 
    "status_idn" INTEGER NOT NULL,
    "unique_session_cd" VARCHAR DEFAULT (null)
        FOREIGN KEY(user_idn) REFERENCES user(user_idn),
        FOREIGN KEY(status_idn) REFERENCES code_status(status_idn)
)


--Create User Activity

CREATE  TABLE  IF NOT EXISTS "main"."user_activity" (
    "user_activity_idn" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL ,  
    "is_authorized" INTEGER NOT NULL , 
    "crt_dt" DATETIME NOT NULL  DEFAULT CURRENT_TIMESTAMP, 
    "status_idn" INTEGER NOT NULL , 
    "user_session_idn" INTEGER NOT NULL,
    FOREIGN KEY(user_idn) REFERENCES user(user_idn),
        FOREIGN KEY(status_idn) REFERENCES code_status(status_idn)
        FOREIGN KEY(user_session_idn) REFERENCES user_session(user_session_idn)
)